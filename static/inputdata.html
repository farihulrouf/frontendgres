<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="Responsive Admin &amp; Dashboard Template based on Bootstrap 5" />
    <meta name="author" content="Blp Gresik" />
    <meta name="keywords"
        content="Blp Gresik, bootstrap, bootstrap 5, admin, dashboard, template, responsive, css, sass, html, theme, front-end, ui kit, web" />

    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link rel="shortcut icon" href="img/icons/icon-48x48.png" />

    <link rel="canonical" href="#" />

    <title>Blp Gresik</title>

    <link href="css/app.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />

</head>

<body onload="onloadData()">
    <div class="wrapper">
        <nav id="sidebar" class="sidebar js-sidebar">
            <div class="sidebar-content js-simplebar">
                <a class="sidebar-brand" href="index.html">
                    <span class="align-middle">Blp Gresik</span>
                </a>

                <ul class="sidebar-nav">
                    <li class="sidebar-header">Pages</li>

                    <li class="sidebar-item">
                        <a class="sidebar-link" href="index.html">
                            <i class="align-middle" data-feather="sliders"></i>
                            <span class="align-middle">Dashboard</span>
                        </a>
                    </li>

                    <li class="sidebar-header">Data list</li>

                    <li class="sidebar-item">
                        <a class="sidebar-link" href="datamaster.html">
                            <i class="align-middle" data-feather="square"></i>
                            <span class="align-middle">Data Master</span>
                        </a>
                    </li>

                    <li class="sidebar-item active">
                        <a class="sidebar-link" href="monitoring.html">
                            <i class="align-middle" data-feather="check-square"></i>
                            <span class="align-middle">Monitoring</span>
                        </a>
                    </li>

                    <li class="sidebar-item">
                        <a class="sidebar-link" href="penyedia.html">
                            <i class="align-middle" data-feather="align-left"></i>
                            <span class="align-middle">Penyedia</span>
                        </a>
                    </li>

                    <li class="sidebar-item">
                        <a class="sidebar-link" href="jasa-konsultasi.html">
                            <i class="align-middle" data-feather="coffee"></i>
                            <span class="align-middle">Jasa konsultasi</span>
                        </a>
                    </li>

                    <li class="sidebar-header">Plugins & Addons</li>

                    <li class="sidebar-item">
                        <a class="sidebar-link" href="charts-chartjs.html">
                            <i class="align-middle" data-feather="bar-chart-2"></i>
                            <span class="align-middle">Charts</span>
                        </a>
                    </li>
                </ul>

                <div class="sidebar-cta">
                    <div class="sidebar-cta-content">
                        <strong class="d-inline-block mb-2">Kontak</strong>
                        <div class="mb-3 text-sm">Dapatkan informasi lebih lanjut</div>
                        <div class="d-grid">
                            <a href="#" class="btn btn-primary">Kontak kami</a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <div class="main">
            <nav class="navbar navbar-expand navbar-light navbar-bg">
                <a class="sidebar-toggle js-sidebar-toggle">
                    <i class="hamburger align-self-center"></i>
                </a>
                <div class="row">
                    <div class="col-lg-4">
                        <select class="form-select" aria-label="Default select example" name="tahun" id="tahun">
                            <option value="" selected hidden>2023</option>
                            <option></option>
                        </select>
                    </div>
                    <div class="col-lg-8">
                        <select class="form-select style-select" aria-label="Default select example" id="satuankerja">
                            <option value="" selected hidden>SELURUH SATUAN KERJA</option>
                            <option></option>
                        </select>
                    </div>
                </div>

            </nav>

            <main class="content">
                <div class="container-fluid p-0">


                    <div class="row">
                        <div class="col-lg-11">
                            <select class="select22" style="width: 100%;"></select>
                        </div>
                        <div class="col-lg-1">
                            <input type="button" class="btn btn-success" id="add" value="Add"
                                onclick="Javascript:addRow()"></td>
                        </div>

                    </div>
                   
                    <div class="mb-6 mt-6" id="dataperencanaan">

                    </div>
                    <div class="row">
                        <!--
                            
                        <div class="col-12 col-lg-12">
                            <table id="datatable" class="display" cellspacing="0" width="100%">
                                <thead>
                                    <tr>
                                        <th>Kode rup</th>
                                        <th>Satuan Kerja</th>
                                        <th>Nama paket</th>
                                        <th>Metode Pengadaan.</th>
                                        <th>Nilai Kontrak</th>

                                    </tr>
                                </thead>
                            </table>
                        </div>
                        -->

                        <table id="myTableData" class="table">
                            <thead>
                                <tr>
                                    <th>Action</th>
                                    <th>Nama</th>
                                    <th>Kode</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="mytabledata">

                                </tr>

                            </tbody>
                        </table>

                    </div>
                </div>


            </main>

            <footer class="footer">
                <div class="container-fluid">
                    <div class="row text-muted">
                        <div class="col-6 text-start">
                            <p class="mb-0">
                                <a class="text-muted" href="https://Blp Gresik.io/"
                                    target="_blank"><strong>Admin</strong></a>
                                -
                                <a class="text-muted" href="https://Blp Gresik.io/"
                                    target="_blank"><strong>Admin</strong></a>
                                &copy;
                            </p>
                        </div>
                        <div class="col-6 text-end">
                            <ul class="list-inline">
                                <li class="list-inline-item">
                                    <a class="text-muted" href="https://Blp Gresik.io/" target="_blank">Support</a>
                                </li>
                                <li class="list-inline-item">
                                    <a class="text-muted" href="https://Blp Gresik.io/" target="_blank">Help Center</a>
                                </li>
                                <li class="list-inline-item">
                                    <a class="text-muted" href="https://Blp Gresik.io/" target="_blank">Privacy</a>
                                </li>
                                <li class="list-inline-item">
                                    <a class="text-muted" href="https://Blp Gresik.io/" target="_blank">Terms</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>

    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha256-CjSoeELFOcH0/uxWu6mC/Vlrc1AARqbm/jiiImDGV3s=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <!-- Hierarchy Select Js -->
    <script src="js/hierarchy-select.min.js"></script>

    <script>
        $(document).ready(function () {
            $("select.select22").select2({
                ajax: {

                    //url: "https://api.github.com/search/repositories",
                    url: "http://localhost:8000/api/datapakets/getdata?tahun=2023",
                    dataType: 'json',
                    data: (params) => {
                        return {
                            s: params.term,
                        }
                    },
                    processResults: (data, params) => {
                        //console.log("ini data", data)
                        const results = data.data.map(item => {
                            return {
                                id: item.kode_rup,
                                text: item.kode_rup + " | " + item.nama_paket,
                            };
                        });
                        return {
                            results: results,
                        }
                    },
                },
            });
        })
        $(document).ready(function () {
            $("#myBtn").click(function () {
                $("#myModal").modal({ show: true });
            });

        });
        $(document).ready(function () {
            var satker = [
                "BADAN KEPEGAWAIAN DAERAH DAN PENGEMBANGAN SUMBER DAYA MANUSIA",
                "BADAN KESATUAN BANGSA DAN POLITIK",
                "BADAN PENANGGULANGAN BENCANA DAERAH",
                "BADAN PENDAPATAN PENGELOLAAN KEUANGAN DAN ASET DAERAH",
                "BADAN PERENCANAAN PEMBANGUNAN PENELITIAN DAN PENGEMBANGAN DAERAH",
                "DINAS CIPTA KARYA PERUMAHAN DAN KAWASAN PERMUKIMAN",
                "DINAS KELUARGA BERENCANA PEMBERDAYAAN PEREMPUAN DAN PERLINDANGAN ANAK KABUPATEN GRESIK",
                "DINAS KEPENDUDUKAN DAN PENCATATAN SIPIL",
                "DINAS KESEHATAN",
                "DINAS KOMUNIKASI DAN INFORMATIKA",
                "DINAS KOPERASI USAHA MIKRO PERINDUSTRIAN DAN PERDAGANGAN KABUPATEN GRESIK",
                "DINAS LINGKUNGAN HIDUP KABUPATEN GRESIK",
                "DINAS PARIWISATA DAN EKONOMI KREATIF KEBUDAYAAN KEPEMUDAAN DAN OLAH RAGA",
                "DINAS PEKERJAAN UMUM DAN TATA RUANG",
                "DINAS PEMADAM KEBAKARAN DAN PENYELAMATAN",
                "DINAS PEMBERDAYAAN MASYARAKAT DAN DESA KABUPATEN GRESIK",
                "DINAS PENANAMAN MODAL DAN PTSP KABUPATEN GRESIK",
                "DINAS PENDIDIKAN",
                "DINAS PERHUBUNGAN",
                "DINAS PERIKANAN KABUPATEN GRESIK",
                "DINAS PERPUSTAKAAN DAN KEARSIPAN KABUPATEN GRESIK",
                "DINAS PERTANIAN KABUPATEN GRESIK",
                "DINAS SOSIAL",
                "DINAS TENAGA KERJA",
                "INSPEKTORAT",
                "KECAMATAN BALONGPANGGANG",
                "KECAMATAN BUNGAH",
                "KECAMATAN CERME",
                "KECAMATAN DRIYOREJO",
                "KECAMATAN DUDUK SAMPEYAN",
                "KECAMATAN DUKUN",
                "KECAMATAN GRESIK",
                "KECAMATAN KEBOMAS",
                "KECAMATAN MANYAR",
                "KECAMATAN PANCENG",
                "KECAMATAN SIDAYU",
                "KECAMATAN UJUNGPANGKAH",
                "KECAMATAN WRINGINANOM",
                "SATUAN POLISI PAMONG PRAJA",
                "SEKRETARIAT DAERAH",
                "SEKRETARIAT DPRD"
            ]
            $("#satuankerja").select2({
                data: satker
            })
        })

        $(document).ready(function () {
            var tahun = [
                "2024", "2023", "2022", "2021"
            ]
            $("#tahun").select2({
                data: tahun
            })
        })


    </script>
    <script src="js/app.js"></script>
    <script>
        function loadData() {
            getData('2023', 'SELURUH SATUAN KERJA')
        }

        $("#tahun").on("change", function () {

            var text = $("#tahun option:selected").text();
            var datasatuan = $("#satuankerja option:selected").text();
            console.log(datasatuan)
            getData(text, datasatuan)

        });

        $("#tahun").on("change", function () {

            var text = $("#tahun option:selected").text();
            var datasatuan = $("#satuankerja option:selected").text();
            console.log(datasatuan)
            getData(text, datasatuan)

        });


        $(".select22").on("change", function () {

            var text = $(".select22 option:selected").text();
            //var datasatuan = $("#satuankerja option:selected").text();
            console.log(text)
            //getData(text, datasatuan)

        });



        $("#satuankerja").on("change", function () {

            var text = $("#tahun option:selected").text();
            var datasatuan = $("#satuankerja option:selected").text();
            // console.log(datasatuan)
            getData(text, datasatuan)

        });

        function onloadData() {
            const datax = JSON.parse(localStorage.getItem('penyedia'));
            console.log("info data", datax)
            str_html = ""
            getData()
            //console.log(datax)
            str_html += `
                    <div class="row">
                    <div class="col-lg-10">
                     <h1 class="h3 d-inline align-middle"> ${datax.nama}</h1>
                        <a class="badge bg-dark text-white ms-2" href="#">
                            npwp: ${datax.npwp}
                        </a>
                    </div>
                    <div class="col-lg-2">
                        <input type="button" class="btn btn-success" id="postdata" value="postdata"
                            onclick="Javascript:postData()"></input>
                     </div>
                    </div>	

			`
            $("#dataperencanaan").html(str_html)

        }
        function getData() {

            const datax = JSON.parse(localStorage.getItem('penyedia'));
            const api = 'http://localhost:8000/api/datapakets/detailpemenang?idpemenang='
            //getData(datax.kode_rup)
            //http://localhost:8000/api/datapakets/getwinpro?id=4
            var table = $("#datatable").DataTable({
                prerender: true,
                destroy: true,
                ajax:

                {
                    "url": "http://localhost:8000/api/datapakets/getwinpro?id=" + datax.id,
                    "type": "GET",
                    "dataType": "JSON"
                },
                //    "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
                //$(nTd).html("<a href='tel:"+oData.TelephoneNumber+"'>"+oData.TelephoneNumber+"</a>");

                //}
                columns: [
                    { data: "kode_rup" },
                    { data: "satuan_kerja" },
                    {
                        data: "nama_paket",
                        "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
                            $(nTd).html('<a href="javascript:callModal(\'' + oData.kode_rup + '\',\'' + oData.nama_paket + '\',\'' + oData.satuan_kerja + '\',\'' + oData.nilai_kontrak + '\')">' + oData.nama_paket + '</a>');
                        }
                    },
                    // $(nTd).html("<a href=#"+"onclick='callModal('data');'>" + oData.nama_paket + "</a>"
                    { data: "metode_pengadaan" },


                    { data: "nilai_kontrak" }
                ],
            });
        }

        function callModal(data, nama_paket, satker, nilai_kontrak, metode) {
            // console.log('fungsi di panggil', data)
            const dataPaket = { kode_rup: data, nama_paket: nama_paket, satker: satker, nilai_kontrak: nilai_kontrak, metode_pengadaan: metode };
            //  console.log(dataPaket.kode_rup)
            // console.log(dataPaket)
            localStorage.setItem('datapaket', JSON.stringify(dataPaket));


            //const datax = JSON.parse(localStorage.getItem('datapaket'));


            // const datax = localStorage.getItem('datapaket');
            //console.log(datax.kode_rup)
            //const todos = [data, nama_paket, satker, nilai_kontrak ];
            //localStorage.setItem("inputValue", dataPaket);
            window.location.href = "detail-project.html";
        }
    </script>
    <script>
        function addRow() {

            //var myName = "data dua";
            var myName = $(".select22 option:selected").text();


            const koderup = myName.substring(0, myName.indexOf('|'));

            //console.log("The substring before the specific character is:", subBefore);
            const nama_paket = myName.slice(myName.indexOf('|') + 1);
            console.log(nama_paket)
            // var myName = document.getElementById("name");
            var age = document.getElementById("age");
            var table = document.getElementById("myTableData");

            var rowCount = table.rows.length;
            var row = table.insertRow(rowCount);

            row.insertCell(0).innerHTML = '<input type="button" class="btn btn-danger" value = "Delete" onClick="Javacsript:deleteRow(this)">';
            row.insertCell(1).innerHTML = nama_paket;
            row.insertCell(2).innerHTML = koderup;

        }

        function deleteRow(obj) {

            var index = obj.parentNode.parentNode.rowIndex;
            var table = document.getElementById("myTableData");
            table.deleteRow(index);

        }

        function addTable() {

            var myTableDiv = document.getElementById("myDynamicTable");

            var table = document.createElement('TABLE');
            table.border = '1';

            var tableBody = document.createElement('TBODY');
            table.appendChild(tableBody);

            for (var i = 0; i < 3; i++) {
                var tr = document.createElement('TR');
                tableBody.appendChild(tr);

                for (var j = 0; j < 4; j++) {
                    var td = document.createElement('TD');
                    td.width = '75';
                    td.appendChild(document.createTextNode("Cell " + i + "," + j));
                    tr.appendChild(td);
                }
            }
            myTableDiv.appendChild(table);

        }
        function postData() {

            /* let oTable = document.getElementById('myTableData');
             let data = [...oTable.rows].map(t => [...t.children].map(u => u.innerText))
             console.log(data)
             */
            var tblhdr = $('table#myTableData th').map(function () {
                return $(this).text();
            }).get();

            // console.log(tblhdr);

            var tbl = $('table#myTableData tbody tr').map(function (idx, el) {
                var td = $(el).find('td');
                var obj = { id: idx + 1 };

                //Can work on number of columns
                for (var i = 0; i < tblhdr.length; i++) {
                    obj[tblhdr[i]] = td.eq(i).text();
                }

                return obj;
            }).get();
            const datax = JSON.parse(localStorage.getItem('penyedia'));
          
            for (i = 1; i < tbl.length; i++) {
               // console.log("print data", tbl[i].Kode)
              
                fetch("http://localhost:8000/api/datapakets/postdata", {

                   
                    method: "POST",

                    body: JSON.stringify({
                        kode_rup: tbl[i].Kode,
                        id: datax.id,
                    }),

                    headers: {
                        "Content-type": "application/json; charset=UTF-8"
                    }
                })

                    .then(response => response.json())
                    .then(json => console.log(json));

                if(i== tbl.length){
                    console.log("selesai")
                }

             
            }
            
           // window.location.href = "detail-master-penyedia.html";
          
        }

        function load() {

            console.log("Page load finished");

        }
    </script>
</body>

</html>